# 埋点

## 概念
* pv（page view）,同一用户对同一页面的访问次数
* uv ，独立用户访问次数
* 收集用户的隐私信息，优化性能体验，进行A/B业务决策
* 收集报错信息，进行监控

::: tip
埋点肯定是跟用户有关的，需要获取系统里的用户信息
:::

 需要返回给后端的数据：
 ```js
 export default function user() {
    return {
        id: 1,  // 用户id
        name: '用户名'， // 用户名
        data: new Date().getTime(),  // 当前时间
        ua: navigator.userAgent,   // 用户访问的设备信息

        // 其他用户信息
        ...
    }
 }
 ```

 构建一个类:
 ```js
 import user from './user'

 class Tracker {
    constructor() {

    }
    /**
     * 上报埋点
     * @params 埋点信息
     */
    sendReport(params = {}) {
        let userInfo = user()
        const body = Object.assign({}, userInfo, params)

        let blob = new Blob([JSON.stringify(body)],{
            type: 'application/json'
        })
        navigator.sendBeacon('http://localhost:3000/tracker')
    }
 }
 ```

 :::warning
 axios,fetch,xhr都会阻塞页面的关闭，当页面关闭时，接口停止<br>
 需要使用浏览器的sendBeacon方法，在页面关闭时继续发送请求，不会阻塞页面的关闭。
 <br>
 但是sendBeacon不支持跨域，不支持JSON
 :::

 配置一个枚举用于区分哪些交互按键需要上报埋点：
 ```js
 
 ```

## 灰度发布

